
<!-- saved from url=(0063)http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Cours Symfony 5 level 1</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="./Cours Symfony 5 level 1_files/prism.css">
<style>
* {
    font-family: Verdana;
}
.container {
    width: 80%;
    margin: auto;
}
@media (max-width: 500px) {
    .container {
        width: 100%;
    }
}
</style>
</head>
<body>
<div class="container">
<hr>
<h1>Cours Symfony 5 level 1</h1>
<h2>par Philippe Giraud pour COGITIUM Academy</h2>
<h2>Version du 19 Juin 2021</h2>
<h2>Version de Symfony utilisée : 5.3</h2>
<h2><a href="mailto:academy@cogitium.com">academy@cogitium.com</a></h2>
<hr>
<h2>PLAN DU COURS</h2>
<pre><a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#pre">Présentation générale</a> 
<a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#ins">Installation de l'environnement de travail</a> 
<a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#dem">Démarrer un projet Symfony</a> 
<a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#git">Git : mettre en place le dépôt</a> 
<a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#rou">Comprendre les routes</a>
<a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#int">Intégration Frontend</a>
<a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#pas">Passage de données entre controller et view</a>
<a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#uti">Gestion des utilisateurs</a>
<a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#ent">Gestion des entités métier</a>
<a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#ini">Gestion des valeurs initiales des entités</a>
<a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#formcat">Création d'un formulaire de création d'une catégorie</a>
<a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#formpost">Création d'un formulaire de création d'un post</a>
<a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#cke">Utilisation d'un éditeur WYSIWYG</a>
<a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#rep">Utiliser le repository pour afficher les données dans les vues</a>
<a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#par">Le système de param converter</a>
<a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#sql1">Faire des requêtes SQL grâce à l'entity manager</a>
<a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#sql2">Faire des requêtes SQL grâce au Query Builder</a>
<a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#crud">Mise en place d'un CRUD d'administration</a>
<a href="http://academy.cogitium.com/simplon/Cours-Symfony5-Level-1.html#navbo">Amélioration du layout backoffice</a>
</pre>
<!--**********************************************************-->
<hr>
<h3 id="pre">PRESENTATION GENERALE</h3>
<h4>Le design Pattern MVC</h4>
<a href="https://fr.wikipedia.org/wiki/Mod%C3%A8le-vue-contr%C3%B4leur" target="_blank">Présentation Wikipedia</a>
<h4>Le framework Symfony</h4>
<a href="https://fr.wikipedia.org/wiki/Symfony" target="_blank">Historique Wikipedia</a>
<h4>Rappels de PHP OO et de MVC</h4>
Manipulation en fonction des cours précédents
<!--**********************************************************-->

<!--**********************************************************-->
<hr>
<h3 id="ins">INSTALLATION DE L'ENVIRONNEMENT DE TRAVAIL</h3>
<a href="https://symfony.com/doc/current/setup.html" target="_blank">https://symfony.com/doc/current/setup.html</a>
<!--**********************************************************-->
<p></p><pre>Installer les logiciels nécessaires :
- CLI Symfony
- Serveur PHP
- Serveur MySQL
- Composer
- Git
- Visual Studio Code avec les extensions :
     + PHP Intelephense
     + PHP Namespace Resolver
     + Twig Language
     * PHPDoc Comment
     * French Language Pack
</pre><p></p>
<p>Vérifier les versions et procéder aux mises à jour nécessaires</p>

<p>Pour vérifier les pré-requis :</p>
<pre class=" language-bash"><code class=" language-bash">symfony check:requirements</code></pre>

<!--**********************************************************-->
<hr>
<h3 id="dem">DEMARRER UN PROJET SYMFONY</h3>
<!--**********************************************************-->
<p>Pour comprendre les versions de Symfony, <a href="https://symfony.com/releases" target="_blank">cliquez ici</a>.</p>

<p>Créer un nouveau projet complet avec le CLI:</p>

<p>Pour installer la dernière branche maintenue (conseillé pour le cours) :</p>
<pre class=" language-bash"><code class=" language-bash">symfony new symfony5-cours --full</code></pre>

<p>Pour installer la version LTS (long-term support) :</p>
<pre class=" language-bash"><code class=" language-bash">symfony new symfony5-cours --version<span class="token operator">=</span>lts</code></pre>

<p>Pour installer une version spécifique :</p>
<pre class=" language-bash"><code class=" language-bash">symfony new symfony5-cours --version<span class="token operator">=</span><span class="token number">5.3</span></code></pre>

<p>Pour installer la version en cours de développement :</p>
<pre class=" language-bash"><code class=" language-bash">symfony new symfony5-cours --version<span class="token operator">=</span>next</code></pre>

<p>Pour installer le projet démo (blog avec frontoffice et backoffice avec SQLite) :</p>
<pre class=" language-bash"><code class=" language-bash">symfony new symfony5-cours --demo</code></pre>

<p>Se placer dans le dossier du projet, puis lancer le serveur interne de Symfony :</p>
<pre class=" language-bash"><code class=" language-bash">symfony server:start</code></pre>

<p>Consulter le résultat sur l'adresse <a href="https://localhost:8000/" target="_blank">https://localhost:8000</a>. 
Une page par défaut s'affiche et indique la version de Symfony</p>

<!--**********************************************************-->
<hr>
<h3 id="git">GIT : METTRE EN PLACE LE DEPOT</h3>  
<!--**********************************************************-->
<p>Vérifier le fonctionnement du dépôt local :</p>
<pre class=" language-bash"><code class=" language-bash"><span class="token function">git</span> status</code></pre>

<p>Constater l'absence de remote dans le dépôt :</p>
<pre class=" language-bash"><code class=" language-bash"><span class="token function">git</span> remote -v</code></pre>

<p>Créer un dépot sur BitBucket ou GitHub sans Readme ni Gitignore</p>
<p>Ajouter les remote dans le git du projet :</p>
<pre class=" language-bash"><code class=" language-bash"><span class="token function">git</span> remote <span class="token function">add</span> origin https://xxxxxxxxx@bitbucket.org/yyyyyy/zzzzzzzz.git</code></pre>

<p>Constater la présence de remote dans le dépôt :</p>
<pre class=" language-bash"><code class=" language-bash"><span class="token function">git</span> remote -v</code></pre>

<p>Vérifier le nom de la branche par défaut :</p>
<pre class=" language-bash"><code class=" language-bash"><span class="token function">git</span> branch</code></pre>

<p>Pusher le dépôt :</p>
<pre class=" language-bash"><code class=" language-bash"><span class="token function">git</span> push -u origin master</code></pre>

<!--**********************************************************-->
<hr>
<h3 id="rou">COMPRENDRE LES ROUTES</h3>
<!--**********************************************************-->
<p>Créer un controller avec le Maker :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console make:controller</code></pre>

<p>Donner un nom au controller : Test</p>

<p>Constater les 2 fichiers créés, un controller et une view, et la route :</p>
<pre class=" language-php"><code class=" language-php">@<span class="token function">Route</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/test"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span></code></pre>

<p>Tester dans le navigateur  <a href="https://localhost:8000/test" target="_blank">https://localhost:8000/test</a>. 
Constater le message : Hello TestController!</p>

<p>Regarder le code de la vue afin de constater l'appel au layout</p>

<p>Créer une autre route avec une méthode et un paramètre :</p>
<pre class=" language-php"><code class=" language-php">@<span class="token function">Route</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/test/{id}"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string double-quoted-string">"test_id"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string double-quoted-string">"GET"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> requirements<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string double-quoted-string">"id"</span><span class="token operator">=</span><span class="token string double-quoted-string">"\d+"</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>

<p>Pour la liste des méthodes HTTP : 
<a href="https://developer.mozilla.org/fr/docs/Web/HTTP/M%C3%A9thode" target="_blank">https://developer.mozilla.org/fr/docs/Web/HTTP/M%C3%A9thode</a></p>

<p>Et faire une vue identique à la première : test.html.twig</p>
<p>Appeler cette vue depuis le controller</p>

<pre class=" language-php"><code class=" language-php">
<span class="token doc-comment comment">/**
 * @Route("/test/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>", name="test_id", methods=<span class="token punctuation">{</span>"GET"<span class="token punctuation">}</span>, requirements=<span class="token punctuation">{</span>"id"="\d+"<span class="token punctuation">}</span>)
 */</span>
 <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">test_id</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
 <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test/test.html.twig'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'controller_name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'TestController'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre>

<p>Tester le paramètre reçu avec Dump and Die :</p>

<pre class=" language-php"><code class=" language-php">
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">test_id</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
<span class="token punctuation">{</span>
    <span class="token function">dd</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test/test.html.twig'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'controller_name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'TestController'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>

<p>Transmettre le paramère à la vue :</p>

<pre class=" language-php"><code class=" language-php">
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">test_id</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
<span class="token punctuation">{</span>
    <span class="token comment">//dd($id);</span>
    <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test/test.html.twig'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'controller_name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'TestController'</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token variable">$id</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>

<p>Tester la valeur reçue dans la vue :</p>

<pre class=" language-html"><code class=" language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>example-wrapper<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello {{ controller_name }}! ✅<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    {{ dump(id) }}
    This friendly message is coming from:
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Your controller at <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ <span class="token punctuation">'</span>C:/wamp64/www/cogitium/bitbucket/symfony5-cours/src/Controller/TestController.php<span class="token punctuation">'</span>|file_link(0) }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>src/Controller/TestController.php<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Your template at <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ <span class="token punctuation">'</span>C:/wamp64/www/cogitium/bitbucket/symfony5-cours/templates/test/index.html.twig<span class="token punctuation">'</span>|file_link(0) }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>templates/test/test.html.twig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre>

<p>Faire des liens dans les vues entre les 2 routes :</p>
<pre class=" language-html"><code class=" language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ path(<span class="token punctuation">'</span>test<span class="token punctuation">'</span>) }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Lien vers test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ path(<span class="token punctuation">'</span>test_id<span class="token punctuation">'</span>, {id: 13}) }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Lien vers test_id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre>

<!--**********************************************************-->
<hr>
<h3 id="int">INTEGRATION FRONTEND</h3>
<!--**********************************************************-->
<p>Partir d'un template et l'intégrer dans le layout</p>
<p><a href="https://startbootstrap.com/theme/clean-blog" target="_blank">https://startbootstrap.com/theme/clean-blog</a></p> 

<p></p><pre>Faire une copie de base.html.twig en clean.html.twig 
et intégrer le layout :
Header : intégrer le Title, css, js_top
Footer : intégrer js_bottom</pre><p></p>

<p></p><pre>Puis créer un controller Post avec les routes :
 /           : home
 /post/{$id} : post_view</pre><p></p>

<p>Dans les vues correspondantes, intégrer les pages index.html et post.html</p>

<p></p><pre>Ajouter les routes :
 /about      : page_about
 /contact    : page_contact</pre><p></p>

<p>Dans les vues correspondantes, intégrer les pages about.htm et contact.html</p>

<p>Tester les différentes routes</p>

<p>Intégrer les ressources statiques dans le dossier public, dans un sous-dossier clean</p>

<p>Présenter l'intérêt de la fonction asset() avec un css perso et une route à 2 niveaux</p>

<p>Puis mettre à jour les Urls dans le layout :</p>
<pre class=" language-bash"><code class=" language-bash">    <span class="token operator">&lt;</span><span class="token operator">!</span>-- Bootstrap core CSS --<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>link <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"{{ asset('clean/vendor/bootstrap/css/bootstrap.min.css') }}"</span> <span class="token assign-left variable">rel</span><span class="token operator">=</span><span class="token string">"stylesheet"</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span>-- Custom fonts <span class="token keyword">for</span> this template --<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>link <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"{{ asset('clean/vendor/fontawesome-free/css/all.min.css') }}"</span> <span class="token assign-left variable">rel</span><span class="token operator">=</span><span class="token string">"stylesheet"</span> <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"text/css"</span><span class="token operator">&gt;</span>

</code></pre>

<p>Mettre en place les liens de navigation sur les routes souhaitées</p>

<p>Exemple : </p>
<pre class=" language-bash"><code class=" language-bash"><span class="token operator">&lt;</span>a <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"navbar-brand"</span> <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"{{ path('home') }}"</span><span class="token operator">&gt;</span>My Symfony Blog<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>
</code></pre>

<!--**********************************************************-->
<hr>
<h3 id="pas">PASSAGE DE DONNEES ENTRE CONTROLLER ET VIEW</h3>
<!--**********************************************************-->
<p>Pour comprendre le passage de données, depuis le controller post/view, 
envoyer un objet avec un titre et un contenu :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'post/post.html.twig'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'post'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Le titre'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'content'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Le super contenu'</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>

<p>Puis utiliser ces données dans la vue correspondante :</p>

<pre class=" language-html"><code class=" language-html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>{{ post.title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ post.content }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre>

<!--**********************************************************-->
<hr>
<h3 id="uti">GESTION DES UTILISATEURS</h3>
<!--**********************************************************-->
<p>Début de la construction de la base de données, avec une entitée principale pour gérer les utilisateurs.</p>

<p></p><pre>Nous allons utiliser des mécanismes proposés par Symfony pour :
- Proposer à un utilisateur de s'enregistrer
- Confirmer son inscription
- Réinitialiser son mot de passe

Pour cela, nous allons utiliser :
- La base de données et donc l'ORM Doctrine
- L'envoi de mail et donc un SMTP</pre><p></p>

<p>Commençons par configurer ces 2 mécanismes. Editer le fichier .env à la racine du projet :</p>

<pre class=" language-php"><code class=" language-php">
    <span class="token comment">###&gt; symfony/mailer ###</span>
    <span class="token constant">MAILER_DSN</span><span class="token operator">=</span><span class="token argument-name">smtp</span><span class="token punctuation">:</span><span class="token comment">//localhost:1025</span>
    <span class="token comment">###&lt; symfony/mailer ###</span>

    <span class="token comment">###&gt; doctrine/doctrine-bundle ###</span>
    <span class="token comment"># Format described at https://www.doctrine-project.org/projects/doctrine-dbal/en/latest/reference/configuration.html#connecting-using-a-url</span>
    <span class="token comment"># IMPORTANT: You MUST configure your server version, either here or in config/packages/doctrine.yaml</span>
    <span class="token comment">#</span>
    <span class="token comment"># DATABASE_URL="sqlite:///%kernel.project_dir%/var/data.db"</span>
    <span class="token constant">DATABASE_URL</span><span class="token operator">=</span><span class="token string double-quoted-string">"mysql://root:@127.0.0.1:3306/symfony5_cours?serverVersion=5.7"</span>
    <span class="token comment"># DATABASE_URL="postgresql://db_user:db_password@127.0.0.1:5432/db_name?serverVersion=13&amp;charset=utf8"</span>
    <span class="token comment">###&lt; doctrine/doctrine-bundle ###</span>
</code></pre>

<p>Pour utiliser MariaDB il faut préciser :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token constant">DATABASE_URL</span><span class="token operator">=</span><span class="token string double-quoted-string">"mysql://root:@127.0.0.1:3306/symfony5_cours?serverVersion=10.4.17-MariaDB"</span>
</code></pre>

<p>Il faut maintenant créer la base de données physique telle que définie dans la config :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console doctrine:database:create</code></pre>

<p>Constater dans PhpMyAdmin la création effective.</p>

<p>Nous pouvons utiliser le Maker de Symfony pour générer beaucoup de choses, notament pour la gestion utilisateur. Regarder les options de la commande make :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console <span class="token function">make</span></code></pre>

<p>Nous pouvons maintenant créer la première entité de la BD qui sera User :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console make:user</code></pre>

<p>Ici le mot "user" ne préjuge pas du futur nom de l'entité.</p>

<p>Les valeurs : User, Yes, email, Yes.</p>

<p>Constater les fichiers créés.</p>

<p><b>ATTENTION : </b>en version 5.3 il y a des dépréciations. A la date du mois de Juin 2021 en version, il faut modifier l'entité User :</p>
<pre class=" language-php"><code class=" language-php"><span class="token doc-comment comment">/**
* A visual identifier that represents this user.
*
* <span class="token keyword">@see</span> UserInterface
*/</span>
<span class="token comment">//public function getUserIdentifier(): string</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span>
<span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">email</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>

<p>On a une nouvelle entité, on peut la persister dans la BD. Créer une migration :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console make:migration</code></pre>

<p>Constater le contenu du fichier.</p>

<p>Envoyer la migration sur la BD :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console doctrine:migrations:migrate</code></pre>

<p>Constater la table dans la BD et la table des migrations.</p>

<p>Création du système d'authentification :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console make:auth</code></pre>

<p>Les valeurs : 1, UserAuthenticator, SecurityController, Yes.</p>

<p>Remarquer le TODO dans la console.</p>

<p>Modifier le fichier App\Security\UserAuthenticator :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">onAuthenticationSuccess</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token class-name type-declaration">TokenInterface</span> <span class="token variable">$token</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$providerKey</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$targetPath</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">getTargetPath</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$providerKey</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RedirectResponse</span><span class="token punctuation">(</span><span class="token variable">$targetPath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RedirectResponse</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">urlGenerator</span><span class="token operator">-&gt;</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'home'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//throw new \Exception('TODO: provide a valid redirect inside '.__FILE__);</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Création de l'inscription utilisateur :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console make:registration-form</code></pre>

<p>Les valeurs : yes, yes, no, no-reply@company.com, company.com, yes.</p>

<p>Remarquer le message sur le bundle manquant et les modif à faire :</p>
<pre class=" language-bash"><code class=" language-bash"><span class="token function">composer</span> require symfonycasts/verify-email-bundle</code></pre>

<p>Puis modifier la route dans RegistrationController :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token doc-comment comment">/**
     * @Route("/verify/email", name="app_verify_email")
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">verifyUserEmail</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
    <span class="token punctuation">{</span>
        <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">denyAccessUnlessGranted</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'IS_AUTHENTICATED_FULLY'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// validate email confirmation link, sets User::isVerified=true and persists</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">emailVerifier</span><span class="token operator">-&gt;</span><span class="token function">handleEmailConfirmation</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">VerifyEmailExceptionInterface</span> <span class="token variable">$exception</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">addFlash</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'verify_email_error'</span><span class="token punctuation">,</span> <span class="token variable">$exception</span><span class="token operator">-&gt;</span><span class="token function">getReason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">redirectToRoute</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'app_register'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// @TODO Change the redirect on success and handle or remove the flash message in your templates</span>
        <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">addFlash</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'success'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Your email address has been verified.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">redirectToRoute</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'home'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Afficher les messages flash dans le layout. Il y a un modèle dans register.html.twig :</p>
<pre class=" language-html"><code class=" language-html">    {% for message in app.flashes('success') %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>alert alert-success<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>alert<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ message }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    {% endfor %}
</code></pre>

<p>Faire la migration :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console make:migration</code></pre>

<p>Puis :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console doctrine:migrations:migrate</code></pre>

<p>Constater dans la BD.</p>

<p>Tester l'inscription sur <a href="https://localhost:8000/register" target="_blank">https://localhost:8000/register</a></p>

<p></p><pre>A partir du moment où le register va envoyer un mail de confirmation, il faut deux outils :
- Un serveur SMTP
- Une boite mail
</pre><p></p>

<p></p><pre>Il existe plusiers outils qui font cela, entre autre ces deux là :<br>
- Maildev : un outils qui fonctionne avec NodeJS
    Installation :  <a href="https://github.com/maildev/maildev" target="_blank">https://github.com/maildev/maildev</a>
    ATTENTION : pour tester avec Maildev, il faut le lancer avec l'otion --hide-extensions STARTTLS

- MailHog : une application qui fonctionne sur beaucoup de systèmes
     Installation :  <a href="https://github.com/mailhog/MailHog/blob/master/docs/RELEASES.md" target="_blank">https://github.com/mailhog/MailHog/blob/master/docs/RELEASES.md</a>
</pre><p></p>


<p></p><pre>Constater le mail et le user dans le profiler
Confirmer en cliquant sur le lien dans le mail
Constater la redirection vers home
Constater dans PhpMyAdmin
Tester /logout
Tester /login
</pre><p></p>

<p>Ajouter la réinitialisation du password :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console make:reset-password</code></pre>

<p>Constater le message qui demande un bundle :</p>
<pre class=" language-bash"><code class=" language-bash"><span class="token function">composer</span> require symfonycasts/reset-password-bundle</code></pre>

<p>Relancer le make :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console make:reset-password</code></pre>

<p>Les valeurs : app_login, no-reply@company.com, company.com</p>

<p>Remarquer les notes.</p>

<p>Faire la migration et l'appliquer.</p>

<p>Tester la route <a href="https://localhost:8000/reset-password" target="_blank">https://localhost:8000/reset-password</a></p>

<p>Pour y accèder, mettre un lien dans le form de login.</p>

<h4>Intégration frontend des mécanismes user</h4>

<p>Dans le menu du layout :</p>
<pre class=" language-bash"><code class=" language-bash">    <span class="token punctuation">{</span>% <span class="token keyword">if</span> not is_granted<span class="token punctuation">(</span><span class="token string">"ROLE_USER"</span><span class="token punctuation">)</span> %<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>li <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"nav-item"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>a <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"nav-link"</span> <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"{{ path('app_register') }}"</span><span class="token operator">&gt;</span>S<span class="token string">'inscrire&lt;/a&gt;
        &lt;/li&gt;
        &lt;li class="nav-item"&gt;
            &lt;a class="nav-link" href="{{ path('</span>app_login<span class="token string">') }}"&gt;Login&lt;/a&gt;
        &lt;/li&gt;
    {% else %}
        &lt;li class="nav-item"&gt;
            &lt;a class="nav-link" href="{{ path('</span>app_logout'<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>"<span class="token operator">&gt;</span>Logout<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>/li<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span>% endif %<span class="token punctuation">}</span>
</code></pre>

<p>De façon générale pour les formulaires, appliquer le thème Bootstrap dans le fichier config/packages/twig.yaml :</p>
<pre class=" language-bash"><code class=" language-bash">
twig:
    default_path: <span class="token string">'%kernel.project_dir%/templates'</span>
    form_themes: <span class="token punctuation">[</span><span class="token string">'bootstrap_4_layout.html.twig'</span><span class="token punctuation">]</span>
</code></pre>

<p>Dans les différentes pages (register, login, request), ajouter un peu de structure bootstrap et supprimer l'affichage du flash dans register.</p>

<!--**********************************************************-->
<hr>
<h3 id="ent">GESTION DES ENTITES METIER</h3>
<!--**********************************************************-->
<p>Nous devons gérer des articles (Post) rangés dans des catégories (Category). Ces catégories seront hiérarchiques.</p>

<p>Créer l'entité Category :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console make:entity Category</code></pre>

<p></p><pre>Les valeurs :
- name, string, 100, no
- slug, string, 120, no
- parent, relation, Category, ManyToOne, yes, yes, categories
</pre><p></p>

<p>Faire la migration et l'intégrer.</p>

<p>Créer l'entité Post :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console make:entity Post</code></pre>

<p></p><pre>Les valeurs :
- title, string, 255, no
- slug, string, 255, no
- content, text, no
- image, string, 255, no
- createdAt, datetime, no
- active, boolean, no
- user, relation, User, ManyToOne, no, yes, posts, yes
- category, relation, Category, ManyToOne, no, yes, posts, no
</pre><p></p>

<p>Faire la migration et l'intégrer.</p>

<!--**********************************************************-->
<hr>
<h3 id="ini">GESTION DES VALEURS INITIALES DES ENTITES</h3>
<!--**********************************************************-->
<p></p><pre>Dans cette partie nous allons voir comment gérer l'initialisation de certaines valeurs lors de la création des enregistrements :
- createdAt : datetime de création
- slug : la transformation slug du nom de la catégorie ou du titre de l'article
afin de l'utiliser dans les URLs (SEO).
</pre><p></p>

<p>Pour gérer cela facilement au niveau des annotations, installer l'extension :</p>
<pre class=" language-bash"><code class=" language-bash"><span class="token function">composer</span> require antishov/doctrine-extensions-bundle</code></pre>

<p>Ce n'est pas un package officiel de Symfony, donc il y a une confirmation.</p>

<p>Mettre à jour le fichier config/packages/stof_doctrine_extensions.yaml :</p>
<pre class=" language-yaml"><code class=" language-yaml">
    <span class="token key atrule">stof_doctrine_extensions</span><span class="token punctuation">:</span>
        <span class="token key atrule">default_locale</span><span class="token punctuation">:</span> fr_FR
        <span class="token key atrule">orm</span><span class="token punctuation">:</span>
            <span class="token key atrule">default</span><span class="token punctuation">:</span>
                <span class="token key atrule">sluggable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre>

<p>Dans l'entité Category, on ajoute le Use :</p>
<pre class=" language-php"><code class=" language-php"><span class="token keyword">use</span> <span class="token package">Gedmo<span class="token punctuation">\</span>Mapping<span class="token punctuation">\</span>Annotation</span> <span class="token keyword">as</span> Gedmo<span class="token punctuation">;</span></code></pre>

<p>Puis au niveau de la propriété slug :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@gedmo</span>\Slug(fields=<span class="token punctuation">{</span>"name"<span class="token punctuation">}</span>)
     * @ORM\Column(type="string", length=120)
     */</span>
    <span class="token keyword">private</span> <span class="token variable">$slug</span><span class="token punctuation">;</span>
</code></pre>

<p>On peut supprimer le setter de slug puisqu'il ne sera pas nécessaire.</p>

<!--**********************************************************-->
<hr>
<h3 id="formcat">CREATION D'UN FORMULAIRE DE CREATION D'UNE CATEGORIE</h3>
<!--**********************************************************-->
<p>Il faut créer un formulaire afin de pouvoir créer des catégories. Pour cela, il faut appeler le maker pour créer en premier un controller :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console make:controller AdminController</code></pre>

<p>Puis un formulaire :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console make:form CategoryType</code></pre>

<p>L'associer à l'entité Category.</p>

<p>Constater le controller et le formulaire.</p>

<p>Personnaliser le formulaire :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">buildForm</span><span class="token punctuation">(</span><span class="token class-name type-declaration">FormBuilderInterface</span> <span class="token variable">$builder</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$options</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$builder</span>
            <span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token scope">TextType<span class="token punctuation">::</span></span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token comment">/*-&gt;add('slug')*/</span>
            <span class="token comment">/*-&gt;add('parent')*/</span>
            <span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Valider'</span><span class="token punctuation">,</span> <span class="token scope">SubmitType<span class="token punctuation">::</span></span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Ne pas oublier les use !</p>

<p>Pour personnaliser les labels :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token scope">TextType<span class="token punctuation">::</span></span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token string double-quoted-string">"label"</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"Nom de la catégorie"</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>

<p>Dans le controller, paramétrer les routes. Toutes les pages d'administration seront dans la route /admin et les names commencerons par admin_ :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token doc-comment comment">/**
    * @Route("/admin", name="admin_")
    */</span>
   <span class="token keyword">class</span> <span class="token class-name-definition class-name">AdminController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractController</span>
   <span class="token punctuation">{</span>
       <span class="token doc-comment comment">/**
        * @Route("/", name="home")
        */</span>
       <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
       <span class="token punctuation">{</span>
           <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'admin/index.html.twig'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
               <span class="token string single-quoted-string">'controller_name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'AdminController'</span><span class="token punctuation">,</span>
           <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
</code></pre>

<p>Créer une autre route :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token doc-comment comment">/**
     * @Route("/category/add", name="category_add")
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">addCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'admin/index.html.twig'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'controller_name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'AdminController'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Pour recevoir les données du form, il faut l'objet Request que l'on récupère par l'injection de dépendance.</p>

<p>Puis on instancie une nouvelle category.</p>

<p>Puis on crée le form en lui passant l'instance vide.</p>

<p>On appelle une vue et on lui passe le form transformé en html :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">addCategory</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$category</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Category</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$form</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">createForm</span><span class="token punctuation">(</span><span class="token scope">CategoryType<span class="token punctuation">::</span></span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token variable">$category</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'admin/category/add.html.twig'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'form'</span> <span class="token operator">=&gt;</span> <span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">createView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Créer la vue avec le nom et chemin choisis :</p>
<pre class=" language-bash"><code class=" language-bash">    <span class="token punctuation">{</span>% extends <span class="token string">'base.html.twig'</span> %<span class="token punctuation">}</span>

    <span class="token punctuation">{</span>% block title %<span class="token punctuation">}</span>Ajout d<span class="token string">'une catégorie{% endblock %}
    
    {% block body %}
        &lt;h1&gt;Ajout d'</span>une catégorie<span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
        <span class="token punctuation">{</span><span class="token punctuation">{</span> form<span class="token punctuation">(</span>form<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span>% endblock %<span class="token punctuation">}</span>
</code></pre>

<p>Tester l'affichage du formulaire sur <a href="https://localhost:8000/admin/category/add" target="_blank">https://localhost:8000/admin/category/add</a></p>

<p></p><pre>Il faut maintenant traiter les données en provenance du formulaire
Pour cela il faut :
- Hydrater l'instance avec les données du form récupérées de la requête
- Tester la soumission du form (POST) et la validité des données du form
- Récupérer l'entity Manager (ORM)
- Persister les données (INSERT)
- Valider la transaction (COMMIT)
- Rediriger sur l'accueil de l'admin :</pre><p></p>
<pre class=" language-php"><code class=" language-php">
    <span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">isSubmitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$em</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">getDoctrine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$em</span><span class="token operator">-&gt;</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token variable">$category</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$em</span><span class="token operator">-&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">redirectToRoute</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'admin_home'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Tester l'ajout d'une catégorie, la redirection et constater les données dans la BD.</p>

<p>Tester avec un nom de catégorie complexe, vérifier le slug.</p>

<!--**********************************************************-->
<hr>
<h3 id="formpost">CREATION D'UN FORMULAIRE DE CREATION D'UN POST</h3>
<!--**********************************************************-->
<p>Reproduire la même chose sur Post avec le slug basé sur title, enlever le setter.</p>

<p>Mais sur Post, il faut aussi initialiser la date de création.</p>

<p>Mettre à jour le fichier config/packages/stof_doctrine_extensions.yaml :</p>
<pre class=" language-yaml"><code class=" language-yaml">
    <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">sluggable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">timestampable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre>

<p>Ajouter l'annotation pour créer le timestamp :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token doc-comment comment">/**
     * @Gedmo\Timestampable(on="create")
     * @ORM\Column(type="datetime")
     */</span>
</code></pre>

<p>Et supprimer le setter correspondant.</p>

<p>Créer un form sur Post :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console make:form PostType</code></pre>

<p>Personnaliser le form généré :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">buildForm</span><span class="token punctuation">(</span><span class="token class-name type-declaration">FormBuilderInterface</span> <span class="token variable">$builder</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$options</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$builder</span>
            <span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">,</span> <span class="token scope">TextType<span class="token punctuation">::</span></span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token comment">/*-&gt;add('slug')*/</span>
            <span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">,</span> <span class="token scope">TextareaType<span class="token punctuation">::</span></span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'image'</span><span class="token punctuation">,</span> <span class="token scope">TextType<span class="token punctuation">::</span></span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token comment">/*-&gt;add('createdAt')*/</span>
            <span class="token comment">/*-&gt;add('active')*/</span>
            <span class="token comment">/*-&gt;add('user')*/</span>
            <span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'category'</span><span class="token punctuation">,</span> <span class="token scope">EntityType<span class="token punctuation">::</span></span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">'class'</span> <span class="token operator">=&gt;</span> <span class="token scope">Category<span class="token punctuation">::</span></span><span class="token keyword">class</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Valider'</span><span class="token punctuation">,</span> <span class="token scope">SubmitType<span class="token punctuation">::</span></span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Ajouter une route dans le controller post avec un code similaire à l'ajout de category :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token doc-comment comment">/**
     * @Route("/post/add", name="post_add")
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">addPost</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$post</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$form</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">createForm</span><span class="token punctuation">(</span><span class="token scope">PostType<span class="token punctuation">::</span></span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'post/add.html.twig'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'form'</span> <span class="token operator">=&gt;</span> <span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">createView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Puis une vue :</p>
<pre class=" language-html"><code class=" language-html">    {% extends 'clean.html.twig' %}

    {% block title %}Ajout d'un article{% endblock %}
    
    {% block body %}
            <span class="token comment">&lt;!-- Page Header --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>masthead<span class="token punctuation">"</span></span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token style language-css"><span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">url</span><span class="token punctuation">(</span><span class="token selector">'</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">asset</span><span class="token punctuation">(</span><span class="token string">'clean/img/home-bg.jpg'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>'<span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>overlay<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>col-lg-8 col-md-10 mx-auto<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>site-heading<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Clean Blog<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subheading<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>A Blog Theme by Start Bootstrap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- Main Content --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>col-lg-8 col-md-10 mx-auto<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Ajout d'un article<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
                        {{ form(form) }}
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    {% endblock %}
</code></pre>

<p>Lors du test, une erreur apparait :</p>
<pre class=" language-bash"><code class=" language-bash">Object of class App<span class="token punctuation">\</span>Entity<span class="token punctuation">\</span>Category could not be converted to string</code></pre>

<p>La liste déroulante prévue pour lister les catégories ne sait pas qu'elle colonne prendre comme "string". Il faut ajouter une méthode dans l'entité pour la fournir :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Vérifier que le form s'affiche correctement et que la liste est remplie.</p>

<p></p><pre>Maintenant il faut traiter le form :
- Associer l'utilisateur connecté
- Mettre l'indicateur Active à false (pourrait être initialisé dans l'entité)
- Puis faire comme Category pour traiter la persistance</pre><p></p>
<pre class=" language-php"><code class=" language-php">
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">isSubmitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$post</span><span class="token operator">-&gt;</span><span class="token function">setUser</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$post</span><span class="token operator">-&gt;</span><span class="token function">setActive</span><span class="token punctuation">(</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$em</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">getDoctrine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$em</span><span class="token operator">-&gt;</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$em</span><span class="token operator">-&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">redirectToRoute</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'home'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Tester après avoir identifié un user.</p>

<p>Vérifier dans la BD la création de l'article, le slug, la date de création, les clés étrangères.</p>

<!--**********************************************************-->
<hr>
<h3 id="cke">UTILISATION D'UN EDITEUR WYSIWYG</h3>
<a href="https://symfony.com/doc/current/bundles/FOSCKEditorBundle/installation.html" target="_blank">https://symfony.com/doc/current/bundles/FOSCKEditorBundle/installation.html</a>
<!--**********************************************************-->
<p>Télécharger CKEditor :</p>
<pre class=" language-bash"><code class=" language-bash"><span class="token function">composer</span> require friendsofsymfony/ckeditor-bundle</code></pre>

<p>Puis l'installer :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console ckeditor:install</code></pre>

<p>Puis installer les assets de CKEditor :</p>
<pre class=" language-bash"><code class=" language-bash">php bin/console assets:install public</code></pre>

<p>Configurer l'éditeur dans le fichier config/packages/fos_ckeditor.yaml :</p>
<pre class=" language-yaml"><code class=" language-yaml">
<span class="token key atrule">twig</span><span class="token punctuation">:</span>
    <span class="token key atrule">form_themes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">'@FOSCKEditor/Form/ckeditor_widget.html.twig'</span>
<span class="token key atrule">fos_ck_editor</span><span class="token punctuation">:</span>
    <span class="token key atrule">configs</span><span class="token punctuation">:</span>
        <span class="token key atrule">main_config</span><span class="token punctuation">:</span>
            <span class="token key atrule">toolbar</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token punctuation">{</span> 
                    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"styles"</span><span class="token punctuation">,</span> 
                    <span class="token key atrule">items</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Bold'</span><span class="token punctuation">,</span> <span class="token string">'Italic'</span><span class="token punctuation">,</span> <span class="token string">'Underline'</span><span class="token punctuation">,</span> <span class="token string">'Strike'</span><span class="token punctuation">,</span> <span class="token string">'Blockquote'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'Link'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'RemoveFormat'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'NumberedList'</span><span class="token punctuation">,</span> <span class="token string">'BulletedList'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'Outdent'</span><span class="token punctuation">,</span> <span class="token string">'Indent'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'JustifyLeft'</span><span class="token punctuation">,</span> <span class="token string">'JustifyCenter'</span><span class="token punctuation">,</span> <span class="token string">'JustifyRight'</span><span class="token punctuation">,</span> <span class="token string">'JustifyBlock'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'Image'</span><span class="token punctuation">,</span> <span class="token string">'Table'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'Styles'</span><span class="token punctuation">,</span> <span class="token string">'Format'</span><span class="token punctuation">,</span><span class="token string">'Font'</span><span class="token punctuation">,</span><span class="token string">'FontSize'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'TextColor'</span><span class="token punctuation">,</span> <span class="token string">'BGColor'</span><span class="token punctuation">,</span> <span class="token string">'Source'</span><span class="token punctuation">]</span> 
                <span class="token punctuation">}</span>
</code></pre>

<p>Modifier dans le form Post :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token comment">/*-&gt;add('content', TextareaType::class, [*/</span>
    <span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">,</span> <span class="token scope">CKEditorType<span class="token punctuation">::</span></span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token string double-quoted-string">"label"</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"Contenu"</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>

<p>Tester en créant un article en copiant du texte formaté.</p>

<p>Vérifier dans la BD.</p>

<p>Ajouter un menu quand l'utilisateur est connecté :</p>
<pre class=" language-html"><code class=" language-html">{% if not is_granted("ROLE_USER") %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ path(<span class="token punctuation">'</span>app_register<span class="token punctuation">'</span>) }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>S'inscrire<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ path(<span class="token punctuation">'</span>app_login<span class="token punctuation">'</span>) }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
{% else %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ path(<span class="token punctuation">'</span>post_add<span class="token punctuation">'</span>) }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Proposer un article<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ path(<span class="token punctuation">'</span>app_logout<span class="token punctuation">'</span>) }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Logout<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
{% endif %}
</code></pre>

<!--**********************************************************-->
<hr>
<h3 id="rep">UTILISER LE REPOSITORY POUR AFFICHER DES DONNEES DANS LES VUES</h3>
<!--**********************************************************-->
<p>Les données sont dans la BD. Le repository permet, en utilsant l'ORM Doctrine, d'accèder à ces données. Des requêtes génériques sont déjà présentes. Il est donc possible d'aller chercher des données sans écrire de requête.</p>

<p>Dans la page d'accueil, il nous faut tous les posts.</p>

<p>Regarder dans le PostRepository :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token doc-comment comment">/**
    * <span class="token keyword">@method</span> Post|null find($id, $lockMode = null, $lockVersion = null)
    * <span class="token keyword">@method</span> Post|null findOneBy(array $criteria, array $orderBy = null)
    * <span class="token keyword">@method</span> Post[]    findAll()
    * <span class="token keyword">@method</span> Post[]    findBy(array $criteria, array $orderBy = null, $limit = null, $offset = null)
    */</span>
</code></pre>

<p>La méthode findAll() renvoie l'ensemble des enregistrements dans un tableau.</p>

<p>Dans le controller Post/index, ajouter un dump des données :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token class-name type-declaration">PostRepository</span> <span class="token variable">$postRepository</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$posts</span> <span class="token operator">=</span> <span class="token variable">$postRepository</span><span class="token operator">-&gt;</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">dd</span><span class="token punctuation">(</span><span class="token variable">$posts</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>

<p>Afficher la page et constater les différents enregistrements.</p>

<p>On peut maintenant transmettre ce tableau à la vue (et donc à Twig) :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token class-name type-declaration">PostRepository</span> <span class="token variable">$postRepository</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$posts</span> <span class="token operator">=</span> <span class="token variable">$postRepository</span><span class="token operator">-&gt;</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//dd($posts);</span>

        <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'post/index.html.twig'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'posts'</span> <span class="token operator">=&gt;</span> <span class="token variable">$posts</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Ajouter dans la vue le dump de Twig pour afficher les données reçues :</p>
<pre class=" language-html"><code class=" language-html">    {% block body %}
    {{ dump(posts) }}
    <span class="token comment">&lt;!-- Page Header --&gt;</span>
</code></pre>

<p>On peut maintenant utiliser ces données pour les afficher au milieu du Html. Dans le Html on ne garde qu'un article, puis on fait une boucle pour itérer sur chaque enregistrement :</p>
<pre class=" language-html"><code class=" language-html">    {% for post in posts %}

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-preview<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ path(<span class="token punctuation">'</span>post_view<span class="token punctuation">'</span>, {id: 1}) }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-title<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ post.title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ post.image }}<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token style language-css"><span class="token property">width</span><span class="token punctuation">:</span> 100%</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-subtitle<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ post.content }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-meta<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Posted by
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Start Bootstrap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
                on September 24, 2019<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>
                
    {% endfor %}
</code></pre>

<p></p><pre>Constater l'affichage des articles
Il y a quelques points à améliorer :
1 - le texte est trop long, il devrait être tronqué
2 - le texte qui contient du html grâce à CKEditor ne s'affiche pas bien, les balises sont visibles
3 - il reste a afficher les informations de date et d'auteur
4 - il n'y a pas la catégorie
5 - le lien envoie un identifiant en dur
</pre><p></p>

<p>1 = avec le filtre "u.truncate" de Twig, on va tronquer le texte. Mais d'abord il faut installer :</p>
<pre class=" language-bash"><code class=" language-bash"><span class="token function">composer</span> require twig/string-extra</code></pre>

<p>Puis pour tronquer le contenu :</p>
<pre class=" language-html"><code class=" language-html">post.content | u.truncate(150, '...')</code></pre>

<p>2 = avec le filtre "raw" de Twig, on va afficher le texte :</p>
<pre class=" language-html"><code class=" language-html">post.content | u.truncate(150, '...') | raw</code></pre>

<p>3 = l'auteur est accessible par :</p>
<pre class=" language-html"><code class=" language-html">post.user.email</code></pre>

<p>La date est affichable par :</p>
<pre class=" language-html"><code class=" language-html">createdAt | date</code></pre>

<p>Il est préférable d'installer un bundle qui offre différentes possibilités :</p>
<pre class=" language-bash"><code class=" language-bash"><span class="token function">composer</span> require knplabs/knp-time-bundle</code></pre>

<p>On peut par exemple utiliser le filtre ago :</p>
<pre class=" language-html"><code class=" language-html">createdAt | ago</code></pre>

<p>Mais cela affiche en anglais. Il faut installer la traduction :</p>
<pre class=" language-bash"><code class=" language-bash"><span class="token operator">&gt;</span>composer require symfony/translation</code></pre>

<p>Puis modifier dans config/packages/translation.yaml :</p>
<pre class=" language-yaml"><code class=" language-yaml">
    <span class="token key atrule">framework</span><span class="token punctuation">:</span>
    <span class="token key atrule">default_locale</span><span class="token punctuation">:</span> fr
</code></pre>

<p>4 = la catégorie est accessible par post.category.name</p>

<p>5 = dans l'url de la route, il faut remplacer la valeur de id en dur par post.id</p>

<p>Cela doit donner un code comme celui-ci :</p>
<pre class=" language-html"><code class=" language-html">    {% for post in posts %}

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-preview<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ path(<span class="token punctuation">'</span>post_view<span class="token punctuation">'</span>, {id: post.id}) }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-title<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ post.title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-subtitle<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ post.content | u.truncate(150, "...") | raw }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-meta<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                Ecrit par {{ post.user.email }} {{ post.createdAt | ago}} - Classé dans {{ post.category.name }}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>

    {% endfor %}
</code></pre>

<!--**********************************************************-->
<hr>
<h3 id="par">LE SYSTEME DE PARAM CONVERTER</h3>
<!--**********************************************************-->
<p>La page de liste des posts appelle la page de détail d'un post en lui transmettant l'Id.</p>

<p>En typant le paramètre en entrée de la méthode, Symfony peut faire la conversion de paramètre afin de retrouver l'instance correspondante.</p>

<p>Il n'y a rien d'autre à faire, c'est le "Param Converter" :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token doc-comment comment">/**
     * @Route("/post/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>", name="post_view", methods=<span class="token punctuation">{</span>"GET"<span class="token punctuation">}</span>, requirements=<span class="token punctuation">{</span>"id"="\d+"<span class="token punctuation">}</span>)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">post</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Post</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
    <span class="token punctuation">{</span>
        <span class="token function">dd</span><span class="token punctuation">(</span><span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>

<p>Constater l'affichage des données de l'article.</p>

<p>Et ce qui fonctionne avec l'Id fonctionne aussi avec le Slug.</p>

<p>Modifier la route et la vue qui génère le lien :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token doc-comment comment">/**
     * ---Route("/post/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>", name="post_view", methods=<span class="token punctuation">{</span>"GET"<span class="token punctuation">}</span>, requirements=<span class="token punctuation">{</span>"id"="\d+"<span class="token punctuation">}</span>)
     * @Route("/post/<span class="token punctuation">{</span>slug<span class="token punctuation">}</span>", name="post_view", methods=<span class="token punctuation">{</span>"GET"<span class="token punctuation">}</span>)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">post</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Post</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
</code></pre>

<pre class=" language-html"><code class=" language-html">    {% for post in posts %}

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-preview<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ path(<span class="token punctuation">'</span>post_view<span class="token punctuation">'</span>, {slug: post.slug}) }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</code></pre>

<p>Constater le dump, puis envoyer le tableau à la vue :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">post</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Post</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//dd($post);</span>
        <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'post/post.html.twig'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'post'</span> <span class="token operator">=&gt;</span> <span class="token variable">$post</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Comme on avait simuler le title et le content, ils devraient s'afficher dans la vue après avoir enlevé le dump.</p>

<p>Avec les principes déjà vus, il est possible d'améliorer cette page.</p>

<!--**********************************************************-->
<hr>
<h3 id="sql1">FAIRE DES REQUETES SQL GRACE A L'ENTITY MANAGER</h3>
<a href="https://symfony.com/doc/current/doctrine.html#querying-for-objects-the-repository">https://symfony.com/doc/current/doctrine.html#querying-for-objects-the-repository</a>
<!--**********************************************************-->
<p>Pour l'instant nous avons utilisé une requête générique proposée par le repository.</p>

<p>Mais il est possible de définir des requêtes spécifiques directement en SQL.</p>

<p>faut utiliser cette technique si la requête est figée, donc si elle n'accepte pas de paramètres externes.</p>

<p>Dans les autres cas, il faut passer par le Query Builder qui va gérer les paramètres et sécuriser les injections SQL.</p>

<p></p><pre>Par exemple, nous pouvons faire une requête afin d'être plus précis sur les articles affichés dans la page d'accueil.
Nous allons demander :
- juste les colonnes nécessaires
- juste les posts avec le statut active à true
- les article triés par ordre chronologique
- seulement les 5 derniers articles (sauf nombre précisé)</pre><p></p>

<p>Ajouter une fonction dans le repository Post :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">findOldPosts</span><span class="token punctuation">(</span><span class="token keyword type-hint">int</span> <span class="token variable">$nb</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$entityManager</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">getEntityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$query</span> <span class="token operator">=</span> <span class="token variable">$entityManager</span><span class="token operator">-&gt;</span><span class="token function">createQuery</span><span class="token punctuation">(</span>
            <span class="token string single-quoted-string">'SELECT p.slug, p.title, p.createdAt
            FROM App\Entity\Post p
            WHERE p.active = :status
            ORDER BY p.createdAt ASC'</span>
        <span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'status'</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">setMaxResults</span><span class="token punctuation">(</span><span class="token variable">$nb</span><span class="token punctuation">)</span>
        <span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Utiliser une route de test afin de constater le resultat de cette requête.</p>

<p>Cette fonction pourrait servir à remplir une sidebar avec les plus anciens articles.</p>

<p><un exemple="" de="" sidebar="" :<="" p="">
</un></p><pre class=" language-html"><code class=" language-html">            <span class="token comment">&lt;!-- Sidebar --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>col-lg-4 col-md-4 mx-auto<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Les anciens articles<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
                
                {% for oldPost in oldPosts %}
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-preview<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ path(<span class="token punctuation">'</span>post_view<span class="token punctuation">'</span>, {slug: oldPost.slug}) }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-subtitle<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ oldPost.title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-meta<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ oldPost.createdAt | ago }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                {% endfor %}

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre>

<!--**********************************************************-->
<hr>
<h3 id="sql2">FAIRE DES REQUETES SQL GRACE AU QUERY BUILDER</h3>
<a href="https://symfony.com/doc/current/doctrine.html#querying-with-the-query-builder">https://symfony.com/doc/current/doctrine.html#querying-with-the-query-builder</a>
<a href="https://www.doctrine-project.org/projects/doctrine-orm/en/current/reference/query-builder.html">https://www.doctrine-project.org/projects/doctrine-orm/en/current/reference/query-builder.html</a>
<!--**********************************************************-->
<p>Le Query Builder est un mécanisme objet proposé par l'ORM Doctrine. C'est le mécanisme à privilégier lors des requêtes dynamiques car la sécuruté est assurée par l'ORM.</p>

<p></p><pre>Nous allons écrire une requête plus précise pour la page d'accueil pour :
- ne garder que les articles avec active à true
- trier les articles par ordre chronologique inverse
- seulement les 5 derniers articles (sauf nombre précisé)</pre><p></p>

<p>Dans le repository :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">findLastPosts</span><span class="token punctuation">(</span><span class="token keyword type-hint">int</span> <span class="token variable">$nb</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">createQueryBuilder</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'p'</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">andWhere</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'p.active = :active'</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'active'</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'p.createdAt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'DESC'</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">setMaxResults</span><span class="token punctuation">(</span><span class="token variable">$nb</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">getQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Dans le controller :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token class-name type-declaration">PostRepository</span> <span class="token variable">$postRepository</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//$posts = $postRepository-&gt;findAll();</span>
        <span class="token variable">$posts</span> <span class="token operator">=</span> <span class="token variable">$postRepository</span><span class="token operator">-&gt;</span><span class="token function">findLastPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//dd($posts);</span>
        <span class="token variable">$oldPosts</span> <span class="token operator">=</span> <span class="token variable">$postRepository</span><span class="token operator">-&gt;</span><span class="token function">findOldPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//dd($oldPosts);</span>
</code></pre>

<!--**********************************************************-->
<hr>
<h3 id="crud">MISE EN PLACE D'UN CRUD D'ADMINISTRATION</h3>
<!--**********************************************************-->
<p></p><pre>Pour l'instant, nous avons juste dans un controller Admin avec :
- une page d'accueil vide : <a href="https://localhost:8000/admin/">https://localhost:8000/admin/</a>
- la possibilité de créer des catégories : <a href="https://localhost:8000/admin/category/add">https://localhost:8000/admin/category/add</a>
</pre><p></p>

<p>Allons plus loin en créant un module d'administration un peu plus complet.</p>

<p></p><pre>Commençons par réorganiser notre AdminController :
- Créer un dossier Controller/Admin
- Déplacer AdminController dedans
</pre><p></p>

<p>Il faut mettre à jour le Namespace :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Controller<span class="token punctuation">\</span>Admin</span><span class="token punctuation">;</span>
</code></pre>

<p>Nous avons des utilsateurs dans la BD. Pour l'instant ils n'ont pas de Role, donc ils sont juste "ROLE_USER" comme l'indique le getter de l'entité :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$roles</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token property">roles</span><span class="token punctuation">;</span>
        <span class="token comment">// guarantee every user at least has ROLE_USER</span>
        <span class="token variable">$roles</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'ROLE_USER'</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">array_unique</span><span class="token punctuation">(</span><span class="token variable">$roles</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Sur un des users, mettre le rôle administrateur : ["ROLE_ADMIN"].</p>

<p>Pour protéger l'accès à l'admin, aller dans config/packages/security.yaml. Dans access_control, enlever le commentaire. Il est possible de changer la route :</p>
<pre class=" language-yaml"><code class=" language-yaml">
    <span class="token comment"># Easy way to control access for large sections of your site</span>
    <span class="token comment"># Note: Only the *first* access control that matches will be used</span>
    <span class="token key atrule">access_control</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> ^/admin<span class="token punctuation">,</span> <span class="token key atrule">roles</span><span class="token punctuation">:</span> ROLE_ADMIN <span class="token punctuation">}</span>
        <span class="token comment"># - { path: ^/profile, roles: ROLE_USER }</span>
</code></pre>

<p></p><pre>Vérifier que :
- la redirection vers login se fait quand on est pas identifier
- l'accès est refusé quand on est pas admin
- l'accès est autorisé quand on est admin</pre><p></p>

<p>Réorganiser le code afin de mettre la gestion des catégories dans un controller Category :</p>

<p>Intégrer un template pour ce module d'administration :</p>
<p><a href="https://startbootstrap.com/template/sb-admin">https://startbootstrap.com/template/sb-admin</a></p>

<p>Comme pour le premier template, créer le layout, en le plaçant dans template/admin.</p>

<p>Partir du fichier base.twig.html et le renommer en sbadmin.html.twig.</p>

<p>Placer les ressources statiques dans public/sbadmin.</p>

<p>Faire attention au chemin des assets.</p>

<p>Modifier les 2 vues de category pour prendre le layout</p>

<p>index.html.twig :</p>
<pre class=" language-html"><code class=" language-html">    {% extends 'admin/sbadmin.html.twig' %}

    {% block title %}Gestion des catégories{% endblock %}
    
    {% block body %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Gestion des catégories<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    {% endblock %}
</code></pre>

<p>add.html.twig :</p>
<pre class=" language-html"><code class=" language-html">    {% extends 'admin/sbadmin.html.twig' %}

    {% block title %}Ajout d'une catégorie{% endblock %}
    
    {% block body %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Ajout d'une catégorie<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
        {{ form(form) }}
    {% endblock %}
</code></pre>

<p>Dans la page index, il faut une table pour afficher la liste des catégories. Dans la page index de sbadmin, il y a un exemple de DataTable. Le copier et ne garder qu'une seule ligne de données</p>

<p>Après personnalisation des colonnes, il doit rester ceci :</p>
<pre class=" language-html"><code class=" language-html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card mb-4<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card-header<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fas fa-table mr-1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>
            DataTable Example
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card-body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>table-responsive<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>table table-bordered<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataTable<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token attr-name">cellspacing</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Nom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Actions<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tfoot</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Nom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Actions<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tfoot</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>Tiger Nixon<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>System Architect<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>Edinburgh<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>61<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre>

<p></p><pre>Pour alimenter cette vue, il faut que le controller index :
- récupère le repository (injection de dépendance)
- récupère toutes les catégorie (findAll)
- transmette les données à la vue (render)</pre><p></p>
<pre class=" language-php"><code class=" language-php">
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token class-name type-declaration">CategoryRepository</span> <span class="token variable">$categoryRepository</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'admin/category/index.html.twig'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'categories'</span> <span class="token operator">=&gt;</span> <span class="token variable">$categoryRepository</span><span class="token operator">-&gt;</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Faire un dump(categories) dans la vue pour vérifier le fonctionnement.</p>

<p>Faire l'intégration Twig afin d'afficher les données grace à une boucle :</p>
<pre class=" language-html"><code class=" language-html">    {% for category in categories %}

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ category.id }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ category.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ category.parent }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        
    {% endfor %}
</code></pre>

<p>Ajouter un bouton ajouter qui déclenche la route admin_category_add (penser à modifier la redirection lors du add) :</p>
<pre class=" language-html"><code class=" language-html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ path(<span class="token punctuation">'</span>admin_category_add<span class="token punctuation">'</span>) }}<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-primary<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Ajouter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre>

<p>Pour l'instant, le parent des catégories n'est pas généré. Aller dans le formulaire catégory et enlever le commentaire sur le parent :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">buildForm</span><span class="token punctuation">(</span><span class="token class-name type-declaration">FormBuilderInterface</span> <span class="token variable">$builder</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$options</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$builder</span>
            <span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token scope">TextType<span class="token punctuation">::</span></span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                <span class="token string double-quoted-string">"label"</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"Nom de la catégorie"</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment">/*-&gt;add('slug')*/</span>
            <span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'parent'</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Valider'</span><span class="token punctuation">,</span> <span class="token scope">SubmitType<span class="token punctuation">::</span></span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Tester l'ajout d'une catégorie avec un parent.</p>

<p>Ajouter le bouton modifier dans la colonne Actions :</p>
<pre class=" language-html"><code class=" language-html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ path(<span class="token punctuation">'</span>admin_category_update<span class="token punctuation">'</span>, {id: category.id}) }}<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-primary btn-sm<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Modifier<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre>

<p></p><pre>Puis dupliquer le code de Add pour créer Update :
- modifier la route avec un paramètre
- récupérer la catégorie par le param Converter
- supprimer le New
- appeler la même vue avec le même form</pre><p></p>
<pre class=" language-php"><code class=" language-php">
    <span class="token doc-comment comment">/**
     * @Route("/update/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>", name="update")
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">updateCategory</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Category</span> <span class="token variable">$category</span><span class="token punctuation">,</span> <span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$form</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">createForm</span><span class="token punctuation">(</span><span class="token scope">CategoryType<span class="token punctuation">::</span></span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token variable">$category</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">isSubmitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$em</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">getDoctrine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$em</span><span class="token operator">-&gt;</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token variable">$category</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$em</span><span class="token operator">-&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">redirectToRoute</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'admin_category_index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'admin/category/add.html.twig'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'form'</span> <span class="token operator">=&gt;</span> <span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">createView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Dupliquer tout cela pour faire la même chose pour les articles. Attention à bien tout changer : category --&gt; post.</p>

<p>Dupliquer le dossier des vues. Idem, changer tous les éléments : category --&gt; post.</p>

<p></p><pre>Ne prévoir que :
- la suppression d'un article
- l'activation/désactivation d'un article</pre><p></p>

<p>Pour l'activation, représenter dans la liste le statut active par un switch.</p>

<p>Prévoir dans ce switch un data-id pour pouvoir déclencher un update en AJAX :</p>
<pre class=" language-html"><code class=" language-html">    {% for post in posts %}

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ post.id }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ post.title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ post.createdAt | date }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>custom-control custom-switch<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>custom-control-input<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>customSwitch{{ post.id }}<span class="token punctuation">"</span></span> <span class="token attr-name">{{</span> <span class="token attr-name">(post.active)</span> <span class="token attr-name">?</span> <span class="token attr-name">'checked'</span> <span class="token attr-name">:</span> <span class="token attr-name">''</span> <span class="token attr-name">}}</span> <span class="token attr-name">data-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ post.id }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>custom-control-label<span class="token punctuation">"</span></span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>customSwitch{{ post.id }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ path(<span class="token punctuation">'</span>admin_post_update<span class="token punctuation">'</span>, {id: post.id}) }}<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-primary btn-sm<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Modifier<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        
    {% endfor %}
</code></pre>

<p>Dans le fichier index.html.twig, ajouter l'ajax dans le block Javascripts :</p>
<pre class=" language-html"><code class=" language-html">    {% block javascripts %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> activate <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"[type=checkbox]"</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> button <span class="token keyword">of</span> activate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">let</span> xmlhttp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span>
                    xmlhttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/admin/post/activate/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
                    xmlhttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    {% endblock %}
</code></pre>

<p>Vérifier l'activation/désactivation des articles.</p>

<p>Créer une route pour la suppression d'un article :</p>
<pre class=" language-php"><code class=" language-php">
    <span class="token doc-comment comment">/**
     * @Route("/delete/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>", name="delete")
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Post</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$em</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">getDoctrine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$em</span><span class="token operator">-&gt;</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$em</span><span class="token operator">-&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">addFlash</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'success'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Article supprimé !'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-&gt;</span><span class="token function">redirectToRoute</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'admin_post_index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>

<p>Nous allons déclencher la suppression depuis un bouton. Il faut un message de confirmation, nous allons faire une modal Bootstrap.</p>

<p>Le bouton qui ouvre la modal :</p>
<pre class=" language-html"><code class=" language-html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-primary<span class="token punctuation">"</span></span> <span class="token attr-name">data-bs-toggle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modal<span class="token punctuation">"</span></span> <span class="token attr-name">data-bs-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#exampleModal<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        Launch demo modal
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre>

<p>La modal :</p>
<pre class=" language-html"><code class=" language-html">    <span class="token comment">&lt;!-- Modal --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modal fade<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modalDelete<span class="token punctuation">"</span></span> <span class="token attr-name">tabindex</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-1<span class="token punctuation">"</span></span> <span class="token attr-name">aria-labelledby</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>exampleModalLabel<span class="token punctuation">"</span></span> <span class="token attr-name">aria-hidden</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modal-dialog<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modal-content<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modal-header<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h5</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modal-title<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>exampleModalLabel<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Supprimer un article<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h5</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>close<span class="token punctuation">"</span></span> <span class="token attr-name">data-dismiss</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modal<span class="token punctuation">"</span></span> <span class="token attr-name">aria-label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Close<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">aria-hidden</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>×<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modal-body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                ...
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modal-footer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-secondary<span class="token punctuation">"</span></span> <span class="token attr-name">data-dismiss</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modal<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Annuler<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-primary<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Supprimer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre>

<p>Le déclenchement de la modal :</p>
<pre class=" language-html"><code class=" language-html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-primary modal-trigger<span class="token punctuation">"</span></span> <span class="token attr-name">data-toggle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modal<span class="token punctuation">"</span></span> <span class="token attr-name">data-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#modalDelete<span class="token punctuation">"</span></span> <span class="token attr-name">data-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ post.id }}<span class="token punctuation">"</span></span> <span class="token attr-name">data-title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ post.title }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Supprimer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
</code></pre>

<p>Tester la suppression d'un post.</p>

<!--**********************************************************-->
<hr>
<h3 id="navbo">AMELIORATION DU LAYOUT BACKOFFICE</h3>
<!--**********************************************************-->
<p></p><pre>Nous avons à notre disposition les routes et les fonctionnalités suivantes :
- /admin : dashboard (à construire)
- /admin/post : Liste des posts
- /admin/category : Liste des catégories
- /admin/category/add : Ajout d'une catégorie
</pre><p></p>

<p>Nous pouvons organiser le menu dans le template Sbadmin. Par exemple :</p>
<pre class=" language-html"><code class=" language-html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                            
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ path(<span class="token punctuation">'</span>admin_home<span class="token punctuation">'</span>) }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sb-nav-link-icon<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fas fa-tachometer-alt<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            Dashboard
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sb-sidenav-menu-heading<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Contenus<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link collapsed<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token attr-name">data-toggle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>collapse<span class="token punctuation">"</span></span> <span class="token attr-name">data-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#collapseLayouts1<span class="token punctuation">"</span></span> <span class="token attr-name">aria-expanded</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">aria-controls</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>collapseLayouts1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sb-nav-link-icon<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fas fa-columns<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            Articles
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sb-sidenav-collapse-arrow<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fas fa-angle-down<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>collapse<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>collapseLayouts1<span class="token punctuation">"</span></span> <span class="token attr-name">aria-labelledby</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>headingOne<span class="token punctuation">"</span></span> <span class="token attr-name">data-parent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#sidenavAccordion<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sb-sidenav-menu-nested nav<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ path(<span class="token punctuation">'</span>admin_post_index<span class="token punctuation">'</span>) }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Gérer les articles<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link collapsed<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token attr-name">data-toggle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>collapse<span class="token punctuation">"</span></span> <span class="token attr-name">data-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#collapseLayouts2<span class="token punctuation">"</span></span> <span class="token attr-name">aria-expanded</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">aria-controls</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>collapseLayouts2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sb-nav-link-icon<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fas fa-columns<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            Catégories
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sb-sidenav-collapse-arrow<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fas fa-angle-down<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>collapse<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>collapseLayouts2<span class="token punctuation">"</span></span> <span class="token attr-name">aria-labelledby</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>headingOne<span class="token punctuation">"</span></span> <span class="token attr-name">data-parent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#sidenavAccordion<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sb-sidenav-menu-nested nav<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ path(<span class="token punctuation">'</span>admin_category_index<span class="token punctuation">'</span>) }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Gérer les catégories<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ path(<span class="token punctuation">'</span>admin_category_add<span class="token punctuation">'</span>) }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Ajouter une catégorie<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre>

<p>En haut à droite, dans le menu déroulant, est prévu le logout :</p>
<pre class=" language-html"><code class=" language-html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>navbar-nav ml-auto ml-md-0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-item dropdown<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nav-link dropdown-toggle<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDropdown<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">data-toggle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dropdown<span class="token punctuation">"</span></span> <span class="token attr-name">aria-haspopup</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">aria-expanded</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fas fa-user fa-fw<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dropdown-menu dropdown-menu-right<span class="token punctuation">"</span></span> <span class="token attr-name">aria-labelledby</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDropdown<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dropdown-item<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Settings<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dropdown-item<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Activity Log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dropdown-divider<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dropdown-item<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ path(<span class="token punctuation">'</span>app_logout<span class="token punctuation">'</span>) }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Logout<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre>

<p>En bas à gauche est prévu l'affichage de la personne connectée :</p>
<pre class=" language-html"><code class=" language-html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sb-sidenav-footer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>small<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Connecté en : {{ app.user.email }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre>

<p>Lors de la suppression d'un article, un flash est généré. Il faut donc l'afficher :</p>
<pre class=" language-html"><code class=" language-html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-link btn-sm order-1 order-lg-0<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sidebarToggle<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fas fa-bars<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
            
    {% for message in app.flashes('success') %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>alert alert-success<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>alert<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ message }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    {% endfor %}

    <span class="token comment">&lt;!-- Navbar Search--&gt;</span>
</code></pre>





<h3>Quelques commandes diverses</h3>
<p></p><pre>php bin/console cache:clear

Afficher la liste des routes :
php bin/console debug:router

Pour afficher le détail d'une route :
php bin/console router:match /about

Voir les variables d'environnement :
php bin/console debug:container --env-vars

Encoder un mot de passe :
symfony console security:encode-password

Idées de sujets :
Messages flash
</pre><p></p>

</div>
<script src="./Cours Symfony 5 level 1_files/prism.js.téléchargement"></script>

</body></html>